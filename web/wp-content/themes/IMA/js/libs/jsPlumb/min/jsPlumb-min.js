!function(){"use strict";var e=jsPlumbUtil,t=function(e,t,n){return jsPlumbAdapter.getOffset(e,t,n)},n=function(){return""+(new Date).getTime()},i=function(e){if(e._jsPlumb.paintStyle&&e._jsPlumb.hoverPaintStyle){var t={};P.extend(t,e._jsPlumb.paintStyle),P.extend(t,e._jsPlumb.hoverPaintStyle),delete e._jsPlumb.hoverPaintStyle,t.gradient&&e._jsPlumb.paintStyle.fillStyle&&delete t.gradient,e._jsPlumb.hoverPaintStyle=t}},s=["click","dblclick","mouseenter","mouseout","mousemove","mousedown","mouseup","contextmenu"],r={mouseout:"mouseleave",mouseexit:"mouseleave"},o=function(e,t,n,i){var s=e.getAttachedElements();if(s)for(var r=0,o=s.length;o>r;r++)i&&i==s[r]||s[r].setHover(t,!0,n)},a=function(e){return null==e?null:e.split(" ")},l=function(t,n,i){if(t.getDefaultType){for(var s=t.getTypeDescriptor(),r=e.merge({},t.getDefaultType()),o=0,a=t._jsPlumb.types.length;a>o;o++)r=e.merge(r,t._jsPlumb.instance.getType(t._jsPlumb.types[o],s),["cssClass"]);n&&(r=e.populate(r,n)),t.applyType(r,i),i||t.repaint()}},u=window.jsPlumbUIComponent=function(t){jsPlumbUtil.EventGenerator.apply(this,arguments);var n=this,i=arguments,o=n.idPrefix,a=o+(new Date).getTime();if(this._jsPlumb={instance:t._jsPlumb,parameters:t.parameters||{},paintStyle:null,hoverPaintStyle:null,paintStyleInUse:null,hover:!1,beforeDetach:t.beforeDetach,beforeDrop:t.beforeDrop,overlayPlacements:[],hoverClass:t.hoverClass||t._jsPlumb.Defaults.HoverClass,types:[]},this.getId=function(){return a},t.events)for(var l in t.events)n.bind(l,t.events[l]);this.clone=function(){var e={};return this.constructor.apply(e,i),e}.bind(this),this.isDetachAllowed=function(t){var n=!0;if(this._jsPlumb.beforeDetach)try{n=this._jsPlumb.beforeDetach(t)}catch(i){e.log("jsPlumb: beforeDetach callback failed",i)}return n},this.isDropAllowed=function(t,n,i,s,r,o,a){var l=this._jsPlumb.instance.checkCondition("beforeDrop",{sourceId:t,targetId:n,scope:i,connection:s,dropEndpoint:r,source:o,target:a});if(this._jsPlumb.beforeDrop)try{l=this._jsPlumb.beforeDrop({sourceId:t,targetId:n,scope:i,connection:s,dropEndpoint:r,source:o,target:a})}catch(u){e.log("jsPlumb: beforeDrop callback failed",u)}return l};var u=[],c=function(e,t,n){u.push([e,t,n]),e.bind(t,n)},d=[],h=function(e,t,n,i){var s=r[n]||n,o=function(e){i&&i(e)===!1||t.fire(s,t,e)};d.push([e,n,o,t]),t._jsPlumb.instance.on(e,n,o)},f=function(e,t,n,i){var s=r[t]||t;i._jsPlumb.instance.off(e,t,n)};this.setListenerComponent=function(e){for(var t=0;t<d.length;t++)d[t][3]=e},this.bindListeners=function(e,t,n){c(e,"click",function(e,n){t.fire("click",t,n)}),c(e,"dblclick",function(e,n){t.fire("dblclick",t,n)}),c(e,"contextmenu",function(e,n){t.fire("contextmenu",t,n)}),c(e,"mouseleave",function(e,i){t.isHover()&&(n(!1),t.fire("mouseleave",t,i))}),c(e,"mouseenter",function(e,i){t.isHover()||(n(!0),t.fire("mouseenter",t,i))}),c(e,"mousedown",function(e,n){t.fire("mousedown",t,n)}),c(e,"mouseup",function(e,n){t.fire("mouseup",t,n)})},this.unbindListeners=function(){for(var e=0;e<u.length;e++){var t=u[e];t[0].unbind(t[1],t[2])}u=null},this.attachListeners=function(e,t,n){n=n||{};for(var i=0,r=s.length;r>i;i++)h(e,t,s[i],n[s[i]])},this.detachListeners=function(){for(var e=0;e<d.length;e++)f(d[e][0],d[e][1],d[e][2],d[e][3]);d=null},this.reattachListenersForElement=function(e){if(arguments.length>1){for(var t=0,n=s.length;n>t;t++)f(e,s[t]);for(t=1,n=arguments.length;n>t;t++)this.attachListeners(e,arguments[t])}}},c=function(e,t){var n=e._jsPlumb.types[t],i=e._jsPlumb.instance.getType(n,e.getTypeDescriptor());null!=i&&i.cssClass&&e.canvas&&e._jsPlumb.instance.removeClass(e.canvas,i.cssClass)};jsPlumbUtil.extend(u,jsPlumbUtil.EventGenerator,{getParameter:function(e){return this._jsPlumb.parameters[e]},setParameter:function(e,t){this._jsPlumb.parameters[e]=t},getParameters:function(){return this._jsPlumb.parameters},setParameters:function(e){this._jsPlumb.parameters=e},addClass:function(e){jsPlumbAdapter.addClass(this.canvas,e)},removeClass:function(e){jsPlumbAdapter.removeClass(this.canvas,e)},setType:function(e,t,n){this.clearTypes(),this._jsPlumb.types=a(e)||[],l(this,t,n)},getType:function(){return this._jsPlumb.types},reapplyTypes:function(e,t){l(this,e,t)},hasType:function(e){return-1!=jsPlumbUtil.indexOf(this._jsPlumb.types,e)},addType:function(e,t,n){var i=a(e),s=!1;if(null!=i){for(var r=0,o=i.length;o>r;r++)this.hasType(i[r])||(this._jsPlumb.types.push(i[r]),s=!0);s&&l(this,t,n)}},removeType:function(t,n){var i=a(t),s=!1,r=function(t){var n=e.indexOf(this._jsPlumb.types,t);return-1!=n?(c(this,n),this._jsPlumb.types.splice(n,1),!0):!1}.bind(this);if(null!=i){for(var o=0,u=i.length;u>o;o++)s=r(i[o])||s;s&&l(this,null,n)}},clearTypes:function(e){for(var t=this._jsPlumb.types.length,n=0;t>n;n++)c(this,0),this._jsPlumb.types.splice(0,1);l(this,{},e)},toggleType:function(e,t,n){var i=a(e);if(null!=i){for(var s=0,r=i.length;r>s;s++){var o=jsPlumbUtil.indexOf(this._jsPlumb.types,i[s]);-1!=o?(c(this,o),this._jsPlumb.types.splice(o,1)):this._jsPlumb.types.push(i[s])}l(this,t,n)}},applyType:function(e,t){if(this.setPaintStyle(e.paintStyle,t),this.setHoverPaintStyle(e.hoverPaintStyle,t),e.parameters)for(var n in e.parameters)this.setParameter(n,e.parameters[n])},setPaintStyle:function(e,t){this._jsPlumb.paintStyle=e,this._jsPlumb.paintStyleInUse=this._jsPlumb.paintStyle,i(this),t||this.repaint()},getPaintStyle:function(){return this._jsPlumb.paintStyle},setHoverPaintStyle:function(e,t){this._jsPlumb.hoverPaintStyle=e,i(this),t||this.repaint()},getHoverPaintStyle:function(){return this._jsPlumb.hoverPaintStyle},cleanup:function(){this.unbindListeners(),this.detachListeners()},destroy:function(){this.cleanupListeners(),this.clone=null,this._jsPlumb=null},isHover:function(){return this._jsPlumb.hover},setHover:function(e,t,i){if(this._jsPlumb&&!this._jsPlumb.instance.currentlyDragging&&!this._jsPlumb.instance.isHoverSuspended()){if(this._jsPlumb.hover=e,null!=this.canvas){if(null!=this._jsPlumb.instance.hoverClass){var s=e?"addClass":"removeClass";this._jsPlumb.instance[s](this.canvas,this._jsPlumb.instance.hoverClass)}null!=this._jsPlumb.hoverClass&&this._jsPlumb.instance[s](this.canvas,this._jsPlumb.hoverClass)}null!=this._jsPlumb.hoverPaintStyle&&(this._jsPlumb.paintStyleInUse=e?this._jsPlumb.hoverPaintStyle:this._jsPlumb.paintStyle,this._jsPlumb.instance.isSuspendDrawing()||(i=i||n(),this.repaint({timestamp:i,recalc:!1}))),this.getAttachedElements&&!t&&o(this,e,n(),this)}}});var d="__label",h=function(e,t){for(var n=-1,i=0,s=e._jsPlumb.overlays.length;s>i;i++)if(t===e._jsPlumb.overlays[i].id){n=i;break}return n},f=function(e,t){var n={cssClass:t.cssClass,labelStyle:e.labelStyle,id:d,component:e,_jsPlumb:e._jsPlumb.instance},i=P.extend(n,t);return new(P.Overlays[e._jsPlumb.instance.getRenderMode()].Label)(i)},p=function(t,n){var i=null;if(e.isArray(n)){var s=n[0],r=P.extend({component:t,_jsPlumb:t._jsPlumb.instance},n[1]);3==n.length&&P.extend(r,n[2]),i=new(P.Overlays[t._jsPlumb.instance.getRenderMode()][s])(r)}else i=n.constructor==String?new(P.Overlays[t._jsPlumb.instance.getRenderMode()][n])({component:t,_jsPlumb:t._jsPlumb.instance}):n;t._jsPlumb.overlays.push(i)},g=function(e,t){var n=e.defaultOverlayKeys||[],i=t.overlays,s=function(t){return e._jsPlumb.instance.Defaults[t]||P.Defaults[t]||[]};i||(i=[]);for(var r=0,o=n.length;o>r;r++)i.unshift.apply(i,s(n[r]));return i},v=window.OverlayCapableJsPlumbUIComponent=function(e){u.apply(this,arguments),this._jsPlumb.overlays=[];var t=g(this,e);if(t)for(var n=0,i=t.length;i>n;n++)p(this,t[n]);if(e.label){var s=e.labelLocation||this.defaultLabelLocation||.5,r=e.labelStyle||this._jsPlumb.instance.Defaults.LabelStyle;this._jsPlumb.overlays.push(f(this,{label:e.label,location:s,labelStyle:r}))}this.setListenerComponent=function(e){if(this._jsPlumb)for(var t=0;t<this._jsPlumb.overlays.length;t++)this._jsPlumb.overlays[t].setListenerComponent(e)}};jsPlumbUtil.extend(v,u,{applyType:function(e,t){if(this.removeAllOverlays(t),e.overlays)for(var n=0,i=e.overlays.length;i>n;n++)this.addOverlay(e.overlays[n],!0)},setHover:function(e,t,n){if(this._jsPlumb&&!this._jsPlumb.instance.isConnectionBeingDragged())for(var i=0,s=this._jsPlumb.overlays.length;s>i;i++)this._jsPlumb.overlays[i][e?"addClass":"removeClass"](this._jsPlumb.instance.hoverClass)},addOverlay:function(e,t){p(this,e),t||this.repaint()},getOverlay:function(e){var t=h(this,e);return t>=0?this._jsPlumb.overlays[t]:null},getOverlays:function(){return this._jsPlumb.overlays},hideOverlay:function(e){var t=this.getOverlay(e);t&&t.hide()},hideOverlays:function(){for(var e=0,t=this._jsPlumb.overlays.length;t>e;e++)this._jsPlumb.overlays[e].hide()},showOverlay:function(e){var t=this.getOverlay(e);t&&t.show()},showOverlays:function(){for(var e=0,t=this._jsPlumb.overlays.length;t>e;e++)this._jsPlumb.overlays[e].show()},removeAllOverlays:function(e){for(var t=0,n=this._jsPlumb.overlays.length;n>t;t++)this._jsPlumb.overlays[t].cleanup&&this._jsPlumb.overlays[t].cleanup();this._jsPlumb.overlays.splice(0,this._jsPlumb.overlays.length),this._jsPlumb.overlayPositions=null,e||this.repaint()},removeOverlay:function(e){var t=h(this,e);if(-1!=t){var n=this._jsPlumb.overlays[t];n.cleanup&&n.cleanup(),this._jsPlumb.overlays.splice(t,1),this._jsPlumb.overlayPositions&&delete this._jsPlumb.overlayPositions[e]}},removeOverlays:function(){for(var e=0,t=arguments.length;t>e;e++)this.removeOverlay(arguments[e])},moveParent:function(e){this.bgCanvas&&(this.bgCanvas.parentNode.removeChild(this.bgCanvas),e.appendChild(this.bgCanvas)),this.canvas&&(this.canvas.parentNode.removeChild(this.canvas),e.appendChild(this.canvas));for(var t=0;t<this._jsPlumb.overlays.length;t++)this._jsPlumb.overlays[t].isAppendedAtTopLevel&&(this._jsPlumb.overlays[t].canvas.parentNode.removeChild(this._jsPlumb.overlays[t].canvas),e.appendChild(this._jsPlumb.overlays[t].canvas))},getLabel:function(){var e=this.getOverlay(d);return null!=e?e.getLabel():null},getLabelOverlay:function(){return this.getOverlay(d)},setLabel:function(e){var t=this.getOverlay(d);if(t)e.constructor==String||e.constructor==Function?t.setLabel(e):(e.label&&t.setLabel(e.label),e.location&&t.setLocation(e.location));else{var n=e.constructor==String||e.constructor==Function?{label:e}:e;t=f(this,n),this._jsPlumb.overlays.push(t)}this._jsPlumb.instance.isSuspendDrawing()||this.repaint()},cleanup:function(){for(var e=0;e<this._jsPlumb.overlays.length;e++)this._jsPlumb.overlays[e].cleanup(),this._jsPlumb.overlays[e].destroy();this._jsPlumb.overlays.splice(0),this._jsPlumb.overlayPositions=null},setVisible:function(e){this[e?"showOverlays":"hideOverlays"]()},setAbsoluteOverlayPosition:function(e,t){this._jsPlumb.overlayPositions=this._jsPlumb.overlayPositions||{},this._jsPlumb.overlayPositions[e.id]=t},getAbsoluteOverlayPosition:function(e){return this._jsPlumb.overlayPositions?this._jsPlumb.overlayPositions[e.id]:null}});var m=0,b=function(){var e=m+1;return m++,e},y=window.jsPlumbInstance=function(i){this.Defaults={Anchor:"BottomCenter",Anchors:[null,null],ConnectionsDetachable:!0,ConnectionOverlays:[],Connector:"Bezier",Container:null,DoNotThrowErrors:!1,DragOptions:{},DropOptions:{},Endpoint:"Dot",EndpointOverlays:[],Endpoints:[null,null],EndpointStyle:{fillStyle:"#456"},EndpointStyles:[null,null],EndpointHoverStyle:null,EndpointHoverStyles:[null,null],HoverPaintStyle:null,LabelStyle:{color:"black"},LogEnabled:!1,Overlays:[],MaxConnections:1,PaintStyle:{lineWidth:8,strokeStyle:"#456"},ReattachConnections:!1,RenderMode:"svg",Scope:"jsPlumb_DefaultScope"},i&&P.extend(this.Defaults,i),this.logEnabled=this.Defaults.LogEnabled,this._connectionTypes={},this._endpointTypes={},jsPlumbUtil.EventGenerator.apply(this);var s=this,r=b(),o=s.bind,a={},l=1,c=function(e){var t=s.getDOMElement(e);return{el:t,id:jsPlumbUtil.isString(e)&&null==t?e:X(t)}};this.getInstanceIndex=function(){return r},this.setZoom=function(e,t){return jsPlumbUtil.oldIE||(l=e,s.fire("zoom",l),t&&s.repaintEverything()),!jsPlumbUtil.oldIE},this.getZoom=function(){return l};for(var d in this.Defaults)a[d]=this.Defaults[d];var h;this.setContainer=function(e){e=this.getDOMElement(e),this.select().each(function(t){t.moveParent(e)}),this.selectEndpoints().each(function(t){t.moveParent(e)}),h=e},this.getContainer=function(){return h},this.bind=function(e,t){"ready"===e&&g?t():o.apply(s,[e,t])},s.importDefaults=function(e){for(var t in e)s.Defaults[t]=e[t];return e.Container&&this.setContainer(e.Container),s},s.restoreDefaults=function(){return s.Defaults=P.extend({},a),s};var f=null,p=null,g=!1,v=[],m={},y={},E={},D={},j={},_={},C=!1,S=[],I=!1,O=null,w=this.Defaults.Scope,A=null,T=1,M=function(){return""+T++},x=function(e,t){h?h.appendChild(e):t?P.getDOMElement(t).appendChild(e):s.appendToRoot(e)},L=function(e){return e._nodes?e._nodes:e},k=function(e,t,i,r){if(!jsPlumbAdapter.headless&&!I){var o=X(e),a=s.dragManager.getElementsForDraggable(o);null==i&&(i=n());var l=K({elId:o,offset:t,recalc:!1,timestamp:i});if(a)for(var u in a)K({elId:a[u].id,offset:{left:l.o.left+a[u].offset.left,top:l.o.top+a[u].offset.top},recalc:!1,timestamp:i});if(s.anchorManager.redraw(o,t,i,null,r),a)for(var c in a)s.anchorManager.redraw(a[c].id,t,i,a[c].offset,r,!0)}},U=function(t,n){var i=null,r,o,a;if(e.isArray(t)){i=[];for(var l=0,u=t.length;u>l;l++)r=s.getElementObject(t[l]),a=s.getDOMElement(r),o=s.getAttribute(a,"id"),i.push(n.apply(s,[a,o]))}else r=s.getDOMElement(t),o=s.getId(r),i=n.apply(s,[r,o]);return i},H=function(e){return y[e]},F=function(t,n,i){if(!jsPlumbAdapter.headless){var r=null==n?!1:n;if(r&&P.isDragSupported(t,s)&&!P.isAlreadyDraggable(t,s)){var o=i||s.Defaults.DragOptions;o=P.extend({},o);var a=P.dragEvents.drag,l=P.dragEvents.stop,u=P.dragEvents.start,c=null,d=s.getDOMElement(t),h=s.dragManager.getDragAncestor(d),f={left:0,top:0},p=f,g=!1;o[u]=e.wrap(o[u],function(){return p=null!=h?jsPlumbAdapter.getOffset(h,s):f,s.setHoverSuspended(!0),s.select({source:t}).addClass(s.elementDraggingClass+" "+s.sourceElementDraggingClass,!0),s.select({target:t}).addClass(s.elementDraggingClass+" "+s.targetElementDraggingClass,!0),s.setConnectionBeingDragged(!0),o.canDrag?i.canDrag():void 0},!1),o[a]=e.wrap(o[a],function(){var e=s.getUIPosition(arguments,s.getZoom());e.left+=p.left,e.top+=p.top,k(t,e,null,!0),g&&s.addClass(t,"jsPlumb_dragged"),g=!0}),o[l]=e.wrap(o[l],function(){var e=s.getUIPosition(arguments,s.getZoom(),!0);k(t,e),g=!1,s.removeClass(t,"jsPlumb_dragged"),s.setHoverSuspended(!1),s.select({source:t}).removeClass(s.elementDraggingClass+" "+s.sourceElementDraggingClass,!0),s.select({target:t}).removeClass(s.elementDraggingClass+" "+s.targetElementDraggingClass,!0),s.setConnectionBeingDragged(!1),s.dragManager.dragEnded(t)});var v=X(t);_[v]=!0;var m=_[v];o.disabled=null==m?!1:!m,s.initDraggable(t,o,!1),s.dragManager.register(t)}}},R=function(t,n){var i=P.extend({},t);if(n&&P.extend(i,n),i.source&&(i.source.endpoint?i.sourceEndpoint=i.source:i.source=s.getDOMElement(i.source)),i.target&&(i.target.endpoint?i.targetEndpoint=i.target:i.target=s.getDOMElement(i.target)),t.uuids&&(i.sourceEndpoint=H(t.uuids[0]),i.targetEndpoint=H(t.uuids[1])),i.sourceEndpoint&&i.sourceEndpoint.isFull())return void e.log(s,"could not add connection; source endpoint is full");if(i.targetEndpoint&&i.targetEndpoint.isFull())return void e.log(s,"could not add connection; target endpoint is full");if(!i.type&&i.sourceEndpoint&&(i.type=i.sourceEndpoint.connectionType),i.sourceEndpoint&&i.sourceEndpoint.connectorOverlays){i.overlays=i.overlays||[];for(var r=0,o=i.sourceEndpoint.connectorOverlays.length;o>r;r++)i.overlays.push(i.sourceEndpoint.connectorOverlays[r])}!i["pointer-events"]&&i.sourceEndpoint&&i.sourceEndpoint.connectorPointerEvents&&(i["pointer-events"]=i.sourceEndpoint.connectorPointerEvents);var a=function(e,t){var n=P.extend({},e);for(var i in t)t[i]&&(n[i]=t[i]);return n},l=function(e,t,n){return s.addEndpoint(e,a(c.def,{anchor:i.anchors?i.anchors[n]:i.anchor,endpoint:i.endpoints?i.endpoints[n]:i.endpoint,paintStyle:i.endpointStyles?i.endpointStyles[n]:i.endpointStyle,hoverPaintStyle:i.endpointHoverStyles?i.endpointHoverStyles[n]:i.endpointHoverStyle}))},u,c,d,h;if(i.target&&!i.target.endpoint&&!i.targetEndpoint&&!i.newConnection&&(u=X(i.target),c=this.targetEndpointDefinitions[u])){if(!c.enabled)return;c.isTarget=!0,h=null!=c.endpoint&&c.endpoint._jsPlumb?c.endpoint:l(i.target,c.def,1),c.uniqueEndpoint&&(c.endpoint=h),i.targetEndpoint=h,h._doNotDeleteOnDetach=!1,h._deleteOnDetach=!0}if(i.source&&!i.source.endpoint&&!i.sourceEndpoint&&!i.newConnection&&(u=X(i.source),c=this.sourceEndpointDefinitions[u])){if(!c.enabled)return;h=null!=c.endpoint&&c.endpoint._jsPlumb?c.endpoint:l(i.source,c.def,0),c.uniqueEndpoint&&(c.endpoint=h),i.sourceEndpoint=h,h._doNotDeleteOnDetach=!1,h._deleteOnDetach=!0}return i}.bind(s),V=function(e){var t=s.Defaults.ConnectionType||s.getDefaultConnectionType(),n=s.Defaults.EndpointType||P.Endpoint;e._jsPlumb=s,e.newConnection=V,e.newEndpoint=z,e.endpointsByUUID=y,e.endpointsByElement=m,e.finaliseConnection=N;var i=new t(e);return i.id="con_"+M(),B("click","click",i),B("dblclick","dblclick",i),B("contextmenu","contextmenu",i),i.isDetachable()&&(i.endpoints[0].initDraggable(),i.endpoints[1].initDraggable()),i},N=function(e,t,n,i){if(t=t||{},e.suspendedEndpoint||v.push(e),e.endpoints[0].isTemporarySource=!1,(null==e.suspendedEndpoint||i)&&s.anchorManager.newConnection(e),k(e.source),!t.doNotFireConnectionEvent&&t.fireEvent!==!1){var r={connection:e,source:e.source,target:e.target,sourceId:e.sourceId,targetId:e.targetId,sourceEndpoint:e.endpoints[0],targetEndpoint:e.endpoints[1]};s.fire("connection",r,n)}},B=function(e,t,n){n.bind(e,function(e,i){s.fire(t,n,i)})},z=function(e){var t=s.Defaults.EndpointType||P.Endpoint,n=P.extend({},e);n._jsPlumb=s,n.newConnection=V,n.newEndpoint=z,n.endpointsByUUID=y,n.endpointsByElement=m,n.finaliseConnection=N,n.fireDetachEvent=tt,n.fireMoveEvent=nt,n.floatingConnections=j,n.elementId=X(n.source);var i=new t(n);return i.id="ep_"+M(),B("click","endpointClick",i),B("dblclick","endpointDblClick",i),B("contextmenu","contextmenu",i),jsPlumbAdapter.headless||s.dragManager.endpointAdded(n.source),i},W=function(e,t,n){var i=m[e];if(i&&i.length)for(var s=0,r=i.length;r>s;s++){for(var o=0,a=i[s].connections.length;a>o;o++){var l=t(i[s].connections[o]);if(l)return}n&&n(i[s])}},q=function(e,t){return U(e,function(e,n){_[n]=t,this.isDragSupported(e)&&this.setElementDraggable(e,t)})},G=function(e,t,n){t="block"===t;var i=null;n&&(i=t?function(e){e.setVisible(!0,!0,!0)}:function(e){e.setVisible(!1,!0,!0)});var s=c(e);W(s.id,function(e){if(t&&n){var i=e.sourceId===s.id?1:0;e.endpoints[i].isVisible()&&e.setVisible(!0)}else e.setVisible(t)},i)},Z=function(e){return U(e,function(e,t){var n=null==_[t]?!1:_[t];return n=!n,_[t]=n,this.setDraggable(e,n),n})},J=function(e,t){var n=null;t&&(n=function(e){var t=e.isVisible();e.setVisible(!t)}),W(e,function(e){var t=e.isVisible();e.setVisible(!t)},n)},K=this.updateOffset=function(e){var n=e.timestamp,i=e.recalc,r=e.offset,o=e.elId,a;return I&&!n&&(n=O),!i&&n&&n===D[o]?{o:e.offset||E[o],s:S[o]}:(i||!r?(a=document.getElementById(o),null!=a&&(S[o]=s.getSize(a),E[o]=t(a,s),D[o]=n)):(E[o]=r,null==S[o]&&(a=document.getElementById(o),null!=a&&(S[o]=s.getSize(a))),D[o]=n),E[o]&&!E[o].right&&(E[o].right=E[o].left+S[o][0],E[o].bottom=E[o].top+S[o][1],E[o].width=S[o][0],E[o].height=S[o][1],E[o].centerx=E[o].left+E[o].width/2,E[o].centery=E[o].top+E[o].height/2),{o:E[o],s:S[o]})},Q=function(e){var t=E[e];return t?{o:t,s:S[e]}:K({elId:e})},X=function(e,t,n){if(jsPlumbUtil.isString(e))return e;if(null==e)return null;var i=s.getAttribute(e,"id");return i&&"undefined"!==i||(2==arguments.length&&void 0!==arguments[1]?i=t:(1==arguments.length||3==arguments.length&&!arguments[2])&&(i="jsPlumb_"+r+"_"+M()),n||s.setAttribute(e,"id",i)),i};this.setConnectionBeingDragged=function(e){C=e},this.isConnectionBeingDragged=function(){return C},this.connectorClass="_jsPlumb_connector",this.hoverClass="_jsPlumb_hover",this.endpointClass="_jsPlumb_endpoint",this.endpointConnectedClass="_jsPlumb_endpoint_connected",this.endpointFullClass="_jsPlumb_endpoint_full",this.endpointDropAllowedClass="_jsPlumb_endpoint_drop_allowed",this.endpointDropForbiddenClass="_jsPlumb_endpoint_drop_forbidden",this.overlayClass="_jsPlumb_overlay",this.draggingClass="_jsPlumb_dragging",this.elementDraggingClass="_jsPlumb_element_dragging",this.sourceElementDraggingClass="_jsPlumb_source_element_dragging",this.targetElementDraggingClass="_jsPlumb_target_element_dragging",this.endpointAnchorClassPrefix="_jsPlumb_endpoint_anchor",this.hoverSourceClass="_jsPlumb_source_hover",this.hoverTargetClass="_jsPlumb_target_hover",this.dragSelectClass="_jsPlumb_drag_select",this.Anchors={},this.Connectors={svg:{},vml:{}},this.Endpoints={svg:{},vml:{}},this.Overlays={svg:{},vml:{}},this.ConnectorRenderers={},this.SVG="svg",this.VML="vml",this.addEndpoint=function(t,n,i){i=i||{};var r=P.extend({},i);P.extend(r,n),r.endpoint=r.endpoint||s.Defaults.Endpoint,r.paintStyle=r.paintStyle||s.Defaults.EndpointStyle,t=L(t);for(var o=[],a=e.isArray(t)||null!=t.length&&!e.isString(t)?t:[t],l=0,u=a.length;u>l;l++){var c=s.getDOMElement(a[l]),d=X(c);r.source=c,bt(r.source),K({elId:d,timestamp:O});var h=z(r);r.parentAnchor&&(h.parentAnchor=r.parentAnchor),e.addToList(m,d,h);var f=E[d],p=S[d],g=h.anchor.compute({xy:[f.left,f.top],wh:p,element:h,timestamp:O}),v={anchorLoc:g,timestamp:O};I&&(v.recalc=!1),I||h.paint(v),o.push(h),h._doNotDeleteOnDetach=!0}return 1==o.length?o[0]:o},this.addEndpoints=function(t,n,i){for(var r=[],o=0,a=n.length;a>o;o++){var l=s.addEndpoint(t,n[o],i);e.isArray(l)?Array.prototype.push.apply(r,l):r.push(l)}return r},this.animate=function(t,n,i){i=i||{};var r=this.getElementObject(t),o=this.getDOMElement(t),a=X(o),l=P.animEvents.step,u=P.animEvents.complete;i[l]=e.wrap(i[l],function(){s.repaint(a)}),i[u]=e.wrap(i[u],function(){s.repaint(a)}),s.doAnimate(r,n,i)},this.checkCondition=function(t,n){var i=s.getListener(t),r=!0;if(i&&i.length>0)try{for(var o=0,a=i.length;a>o;o++)r=r&&i[o](n)}catch(l){e.log(s,"cannot check condition ["+t+"]"+l)}return r},this.checkASyncCondition=function(t,n,i,r){var o=s.getListener(t);if(o&&o.length>0)try{o[0](n,i,r)}catch(a){e.log(s,"cannot asynchronously check condition ["+t+"]"+a)}},this.connect=function(e,t){var n=R(e,t),i;return n&&(bt(n.source),i=V(n),N(i,n)),i};var Y=[{el:"source",elId:"sourceId",epDefs:"sourceEndpointDefinitions"},{el:"target",elId:"targetId",epDefs:"targetEndpointDefinitions"}],et=function(e,t,n,i){var s,r=Y[n],o=e[r.elId],a=e[r.el],l,u,c=e.endpoints[n],d={index:n,originalSourceId:0===n?o:e.sourceId,newSourceId:e.sourceId,originalTargetId:1==n?o:e.targetId,newTargetId:e.targetId,connection:e};if(t.constructor==P.Endpoint)s=t,s.addConnection(e);else if(l=X(t),u=this[r.epDefs][l],l===e[r.elId])s=null;else if(u){if(!u.enabled)return;s=null!=u.endpoint&&u.endpoint._jsPlumb?u.endpoint:this.addEndpoint(t,u.def),u.uniqueEndpoint&&(u.endpoint=s),s._doNotDeleteOnDetach=!1,s._deleteOnDetach=!0,s.addConnection(e)}else s=e.makeEndpoint(0===n,t,l),s._doNotDeleteOnDetach=!1,s._deleteOnDetach=!0;return null!=s&&(c.detachFromConnection(e),e.endpoints[n]=s,e[r.el]=s.element,e[r.elId]=s.elementId,d[0===n?"newSourceId":"newTargetId"]=s.elementId,nt(d),i||e.repaint()),d}.bind(this);this.setSource=function(e,t,n){var i=et(e,t,0,n);this.anchorManager.sourceChanged(i.originalSourceId,i.newSourceId,e)},this.setTarget=function(e,t,n){var i=et(e,t,1,n);this.anchorManager.updateOtherEndpoint(i.originalSourceId,i.originalTargetId,i.newTargetId,e)},this.deleteEndpoint=function(e,t){var n=s.setSuspendDrawing(!0),i="string"==typeof e?y[e]:e;return i&&s.deleteObject({endpoint:i}),n||s.setSuspendDrawing(!1,t),s},this.deleteEveryEndpoint=function(){var e=s.setSuspendDrawing(!0);for(var t in m){var n=m[t];if(n&&n.length)for(var i=0,r=n.length;r>i;i++)s.deleteEndpoint(n[i],!0)}return m={},y={},s.anchorManager.reset(),s.dragManager.reset(),e||s.setSuspendDrawing(!1),s};var tt=function(e,t,n){var i=s.Defaults.ConnectionType||s.getDefaultConnectionType(),r=e.constructor==i,o=r?{connection:e,source:e.source,target:e.target,sourceId:e.sourceId,targetId:e.targetId,sourceEndpoint:e.endpoints[0],targetEndpoint:e.endpoints[1]}:e;t&&s.fire("connectionDetached",o,n),s.anchorManager.connectionDetached(o)},nt=function(e,t){s.fire("connectionMoved",e,t)};this.unregisterEndpoint=function(e){e._jsPlumb.uuid&&(y[e._jsPlumb.uuid]=null),s.anchorManager.deleteEndpoint(e);for(var t in m){var n=m[t];if(n){for(var i=[],r=0,o=n.length;o>r;r++)n[r]!=e&&i.push(n[r]);m[t]=i}m[t].length<1&&delete m[t]}},this.detach=function(){if(0!==arguments.length){var e=s.Defaults.ConnectionType||s.getDefaultConnectionType(),t=arguments[0].constructor==e,n=2==arguments.length&&t?arguments[1]||{}:arguments[0],i=n.fireEvent!==!1,r=n.forceDetach,o=t?arguments[0]:n.connection;if(o)(r||jsPlumbUtil.functionChain(!0,!1,[[o.endpoints[0],"isDetachAllowed",[o]],[o.endpoints[1],"isDetachAllowed",[o]],[o,"isDetachAllowed",[o]],[s,"checkCondition",["beforeDetach",o]]]))&&o.endpoints[0].detach(o,!1,!0,i);else{var a=P.extend({},n);if(a.uuids)H(a.uuids[0]).detachFrom(H(a.uuids[1]),i);else if(a.sourceEndpoint&&a.targetEndpoint)a.sourceEndpoint.detachFrom(a.targetEndpoint);else{var l=X(s.getDOMElement(a.source)),u=X(s.getDOMElement(a.target));W(l,function(e){(e.sourceId==l&&e.targetId==u||e.targetId==l&&e.sourceId==u)&&s.checkCondition("beforeDetach",e)&&e.endpoints[0].detach(e,!1,!0,i)})}}}},this.detachAllConnections=function(e,t){t=t||{},e=s.getDOMElement(e);var n=X(e),i=m[n];if(i&&i.length)for(var r=0,o=i.length;o>r;r++)i[r].detachAll(t.fireEvent!==!1);return s},this.detachEveryConnection=function(e){return e=e||{},s.doWhileSuspended(function(){for(var t in m){var n=m[t];if(n&&n.length)for(var i=0,s=n.length;s>i;i++)n[i].detachAll(e.fireEvent!==!1)}v.splice(0)}),s},this.deleteObject=function(e){var t={endpoints:{},connections:{},endpointCount:0,connectionCount:0},n=e.fireEvent!==!1,i=e.deleteAttachedObjects!==!1,r=function(e){if(null!=e&&null==t.connections[e.id]&&(null!=e._jsPlumb&&e.setHover(!1),t.connections[e.id]=e,t.connectionCount++,i))for(var n=0;n<e.endpoints.length;n++)e.endpoints[n]._deleteOnDetach&&o(e.endpoints[n])},o=function(e){if(null!=e&&null==t.endpoints[e.id]&&(null!=e._jsPlumb&&e.setHover(!1),t.endpoints[e.id]=e,t.endpointCount++,i))for(var n=0;n<e.connections.length;n++){var s=e.connections[n];r(s)}};e.connection?r(e.connection):o(e.endpoint);for(var a in t.connections){var l=t.connections[a];l._jsPlumb&&(jsPlumbUtil.removeWithFunction(v,function(e){return l.id==e.id}),tt(l,n,e.originalEvent),l.endpoints[0].detachFromConnection(l),l.endpoints[1].detachFromConnection(l),l.cleanup(),l.destroy())}for(var u in t.endpoints){var c=t.endpoints[u];c._jsPlumb&&(s.unregisterEndpoint(c),c.cleanup(),c.destroy())}return t},this.draggable=function(e,t){var n,i,r;if("object"==typeof e&&e.length)for(n=0,i=e.length;i>n;n++)r=s.getDOMElement(e[n]),r&&F(r,!0,t);else if(e._nodes)for(n=0,i=e._nodes.length;i>n;n++)r=s.getDOMElement(e._nodes[n]),r&&F(r,!0,t);else r=s.getDOMElement(e),r&&F(r,!0,t);return s};var it=function(e,t,n,i){for(var s=0,r=e.length;r>s;s++)e[s][t].apply(e[s],n);return i(e)},st=function(e,t,n){for(var i=[],s=0,r=e.length;r>s;s++)i.push([e[s][t].apply(e[s],n),e[s]]);return i},rt=function(e,t,n){return function(){return it(e,t,arguments,n)}},ot=function(e,t){return function(){return st(e,t,arguments)}},at=function(e,t){var n=[];if(e)if("string"==typeof e){if("*"===e)return e;n.push(e)}else if(t)n=e;else if(e.length)for(var i=0,s=e.length;s>i;i++)n.push(c(e[i]).id);else n.push(c(e).id);return n},lt=function(e,t,n){return"*"===e?!0:e.length>0?-1!=jsPlumbUtil.indexOf(e,t):!n};this.getConnections=function(e,t){e?e.constructor==String&&(e={scope:e}):e={};for(var n=e.scope||s.getDefaultScope(),i=at(n,!0),r=at(e.source),o=at(e.target),a=!t&&i.length>1?{}:[],l=function(e,n){if(!t&&i.length>1){var s=a[e];null==s&&(s=a[e]=[]),s.push(n)}else a.push(n)},u=0,c=v.length;c>u;u++){var d=v[u];lt(i,d.scope)&&lt(r,d.sourceId)&&lt(o,d.targetId)&&l(d.scope,d)}return a};var ut=function(e,t){return function(n){for(var i=0,s=e.length;s>i;i++)n(e[i]);return t(e)}},ct=function(e){return function(t){return e[t]}},dt=function(e,t){var n={length:e.length,each:ut(e,t),get:ct(e)},i=["setHover","removeAllOverlays","setLabel","addClass","addOverlay","removeOverlay","removeOverlays","showOverlay","hideOverlay","showOverlays","hideOverlays","setPaintStyle","setHoverPaintStyle","setSuspendEvents","setParameter","setParameters","setVisible","repaint","addType","toggleType","removeType","removeClass","setType","bind","unbind"],s=["getLabel","getOverlay","isHover","getParameter","getParameters","getPaintStyle","getHoverPaintStyle","isVisible","hasType","getType","isSuspendEvents"],r,o;for(r=0,o=i.length;o>r;r++)n[i[r]]=rt(e,i[r],t);for(r=0,o=s.length;o>r;r++)n[s[r]]=ot(e,s[r]);return n},ht=function(e){var t=dt(e,ht);return P.extend(t,{setDetachable:rt(e,"setDetachable",ht),setReattach:rt(e,"setReattach",ht),setConnector:rt(e,"setConnector",ht),detach:function(){for(var t=0,n=e.length;n>t;t++)s.detach(e[t])},isDetachable:ot(e,"isDetachable"),isReattach:ot(e,"isReattach")})},ft=function(e){var t=dt(e,ft);return P.extend(t,{setEnabled:rt(e,"setEnabled",ft),setAnchor:rt(e,"setAnchor",ft),isEnabled:ot(e,"isEnabled"),detachAll:function(){for(var t=0,n=e.length;n>t;t++)e[t].detachAll()},remove:function(){for(var t=0,n=e.length;n>t;t++)s.deleteObject({endpoint:e[t]})}})};this.select=function(e){return e=e||{},e.scope=e.scope||"*",ht(e.connections||s.getConnections(e,!0))},this.selectEndpoints=function(e){e=e||{},e.scope=e.scope||"*";var t=!e.element&&!e.source&&!e.target,n=t?"*":at(e.element),i=t?"*":at(e.source),s=t?"*":at(e.target),r=at(e.scope,!0),o=[];for(var a in m){var l=lt(n,a,!0),u=lt(i,a,!0),c="*"!=i,d=lt(s,a,!0),h="*"!=s;if(l||u||d)e:for(var f=0,p=m[a].length;p>f;f++){var g=m[a][f];if(lt(r,g.scope,!0)){var v=c&&i.length>0&&!g.isSource,b=h&&s.length>0&&!g.isTarget;if(v||b)continue e;o.push(g)}}}return ft(o)},this.getAllConnections=function(){return v},this.getDefaultScope=function(){return w},this.getEndpoint=H,this.getEndpoints=function(e){return m[c(e).id]},this.getDefaultEndpointType=function(){return P.Endpoint},this.getDefaultConnectionType=function(){return P.Connection},this.getId=X,this.getOffset=function(e){var t=E[e];return K({elId:e})},this.appendElement=x;var pt=!1;this.isHoverSuspended=function(){return pt},this.setHoverSuspended=function(e){pt=e};var gt=function(e){return function(){return jsPlumbAdapter.isRenderModeAvailable(e)}};this.isSVGAvailable=gt("svg"),this.isVMLAvailable=gt("vml"),this.hide=function(e,t){return G(e,"none",t),s},this.idstamp=M,this.connectorsInitialized=!1;var vt=[],mt=["svg","vml"];this.registerConnectorType=function(e,t){vt.push([e,t])};var bt=function(e){if(!h&&e){var t=s.getDOMElement(e);t.offsetParent&&(h=t.offsetParent)}},yt=function(){s.Defaults.Container&&(h=s.getDOMElement(s.Defaults.Container))};this.init=function(){var e=function(e,t,n){P.Connectors[e][t]=function(){n.apply(this,arguments),P.ConnectorRenderers[e].apply(this,arguments)},jsPlumbUtil.extend(P.Connectors[e][t],[n,P.ConnectorRenderers[e]])};if(!P.connectorsInitialized){for(var t=0;t<vt.length;t++)for(var n=0;n<mt.length;n++)e(mt[n],vt[t][1],vt[t][0]);P.connectorsInitialized=!0}g||(yt(),s.anchorManager=new P.AnchorManager({jsPlumbInstance:s}),s.setRenderMode(s.Defaults.RenderMode),g=!0,s.fire("ready",s))}.bind(this),this.log=f,this.jsPlumbUIComponent=u,this.makeAnchor=function(){var t,n=function(e,t){if(P.Anchors[e])return new P.Anchors[e](t);if(!s.Defaults.DoNotThrowErrors)throw{msg:"jsPlumb: unknown anchor type '"+e+"'"}};if(0===arguments.length)return null;var i=arguments[0],r=arguments[1],o=arguments[2],a=null;if(i.compute&&i.getOrientation)return i;if("string"==typeof i)a=n(arguments[0],{elementId:r,jsPlumbInstance:s});
else if(e.isArray(i))if(e.isArray(i[0])||e.isString(i[0]))2==i.length&&e.isObject(i[1])?e.isString(i[0])?(t=P.extend({elementId:r,jsPlumbInstance:s},i[1]),a=n(i[0],t)):(t=P.extend({elementId:r,jsPlumbInstance:s,anchors:i[0]},i[1]),a=new P.DynamicAnchor(t)):a=new P.DynamicAnchor({anchors:i,selector:null,elementId:r,jsPlumbInstance:o});else{var l={x:i[0],y:i[1],orientation:i.length>=4?[i[2],i[3]]:[0,0],offsets:i.length>=6?[i[4],i[5]]:[0,0],elementId:r,jsPlumbInstance:o,cssClass:7==i.length?i[6]:null};a=new P.Anchor(l),a.clone=function(){return new P.Anchor(l)}}return a.id||(a.id="anchor_"+M()),a},this.makeAnchors=function(t,n,i){for(var r=[],o=0,a=t.length;a>o;o++)"string"==typeof t[o]?r.push(P.Anchors[t[o]]({elementId:n,jsPlumbInstance:i})):e.isArray(t[o])&&r.push(s.makeAnchor(t[o],n,i));return r},this.makeDynamicAnchor=function(e,t){return new P.DynamicAnchor({anchors:e,selector:t,elementId:null,jsPlumbInstance:s})},this.targetEndpointDefinitions={};var Pt=function(e,t,n){e.paintStyle=e.paintStyle||n.Defaults.EndpointStyles[t]||n.Defaults.EndpointStyle,e.hoverPaintStyle=e.hoverPaintStyle||n.Defaults.EndpointHoverStyles[t]||n.Defaults.EndpointHoverStyle,e.anchor=e.anchor||n.Defaults.Anchors[t]||n.Defaults.Anchor,e.endpoint=e.endpoint||n.Defaults.Endpoints[t]||n.Defaults.Endpoint};this.sourceEndpointDefinitions={};var Et=function(e,t,n,i,s){for(var r=e.target||e.srcElement,o=!1,a=i.getSelector(t,n),l=0;l<a.length;l++)if(a[l]==r){o=!0;break}return s?!o:o};this.makeTarget=function(n,i,r){var o=P.extend({_jsPlumb:this},r);P.extend(o,i),Pt(o,1,this);var a=o.scope||s.Defaults.Scope,l=!(o.deleteEndpointsOnDetach===!1),d=o.maxConnections||-1,h=o.onMaxConnections,f=function(n){var i=c(n),s=i.id,r=new u(o),f=P.extend({},o.dropOptions||{});bt(s),this.targetEndpointDefinitions[s]={def:o,uniqueEndpoint:o.uniqueEndpoint,maxConnections:d,enabled:!0};var p=function(){this.currentlyDragging=!1;var e=this.getDropEvent(arguments),n=this.select({target:s}).length,a=this.getDOMElement(this.getDragObject(arguments)),u=this.getAttribute(a,"dragId"),c=this.getAttribute(a,"originalScope"),d=j[u];if(null!=d){var f=d.endpoints[0].isFloating()?0:1,p=d.endpoints[0],g=o.endpoint?P.extend({},o.endpoint):{},v=this.targetEndpointDefinitions[s];if(!v.enabled||v.maxConnections>0&&n>=v.maxConnections)return h&&h({element:i.el,connection:d},e),!1;if(p.anchor.locked=!1,c&&this.setDragScope(a,c),null==d.suspendedEndpoint&&!d.pending)return!1;var m=r.isDropAllowed(0===f?s:d.sourceId,0===f?d.targetId:s,d.scope,d,null,0===f?i.el:d.source,0===f?d.target:i.el);if(d.suspendedEndpoint){d[f?"targetId":"sourceId"]=d.suspendedEndpoint.elementId,d[f?"target":"source"]=d.suspendedEndpoint.element,d.endpoints[f]=d.suspendedEndpoint;var b=d.suspendedEndpoint.getElement(),y=d.suspendedEndpoint.elementId;nt({index:f,originalSourceId:0===f?y:d.sourceId,newSourceId:0===f?s:d.sourceId,originalTargetId:1==f?y:d.targetId,newTargetId:1==f?s:d.targetId,connection:d},e)}if(m){var E=this.getElementObject(i.el),D=v.endpoint;if((null==D||null==D._jsPlumb)&&(D=this.addEndpoint(E,o)),o.uniqueEndpoint&&(v.endpoint=D),D._doNotDeleteOnDetach=!1,D._deleteOnDetach=!0,d.isDetachable()&&D.initDraggable(),null!=D.anchor.positionFinder){var _=this.getUIPosition(arguments,this.getZoom()),C=t(E,this),S=this.getSize(E),I=D.anchor.positionFinder(_,C,S,D.anchor.constructorParams);D.anchor.x=I[0],D.anchor.y=I[1]}d[f?"target":"source"]=D.element,d[f?"targetId":"sourceId"]=D.elementId,d.endpoints[f].detachFromConnection(d),d.endpoints[f]._deleteOnDetach&&(d.endpoints[f].deleteAfterDragStop=!0),D.addConnection(d),d.endpoints[f]=D,d.deleteEndpointsOnDetach=l,1==f?this.anchorManager.updateOtherEndpoint(d.sourceId,d.suspendedElementId,d.targetId,d):this.anchorManager.sourceChanged(d.suspendedEndpoint.elementId,d.sourceId,d),N(d,null,e),d.pending=!1}else d.suspendedEndpoint&&(d.isReattach()?(d.setHover(!1),d.floatingAnchorIndex=null,d.suspendedEndpoint.addConnection(d),this.repaint(p.elementId)):d.deleteConnectionNow=!0)}}.bind(this),g=P.dragEvents.drop;f.scope=f.scope||a,f[g]=e.wrap(f[g],p),o.allowLoopback===!1&&(f.canDrop=function(e){var t=e.getDragElement()._jsPlumbRelatedElement;return t!=i.el}),this.initDroppable(this.getElementObject(i.el),f,!0)}.bind(this);n=L(n);for(var p=n.length&&n.constructor!=String?n:[n],g=0,v=p.length;v>g;g++)f(p[g]);return this},this.unmakeTarget=function(e,t){var n=c(e);return P.destroyDroppable(n.el),t||delete this.targetEndpointDefinitions[n.id],this},this.makeSource=function(n,i,r){var o=P.extend({},r);P.extend(o,i),Pt(o,0,this);var a=o.maxConnections||1,u=o.onMaxConnections,d=function(n){var i=n.id,r=this.getElementObject(n.el),c=this.getDOMElement(r),d=function(){return null==o.parent?null:"parent"===o.parent?n.el.parentNode:s.getDOMElement(o.parent)},f=null!=o.parent?this.getId(d()):i;bt(f),this.sourceEndpointDefinitions[f]={def:o,uniqueEndpoint:o.uniqueEndpoint,maxConnections:a,enabled:!0};var p=P.dragEvents.stop,g=P.dragEvents.drag,v=P.extend({},o.dragOptions||{}),m=v.drag,b=v.stop,y=null,E=!1;v.scope=v.scope||o.scope,v[g]=e.wrap(v[g],function(){m&&m.apply(this,arguments),E=!1}),v[p]=e.wrap(v[p],function(){if(b&&b.apply(this,arguments),this.currentlyDragging=!1,null!=y._jsPlumb){var e=o.anchor||this.Defaults.Anchor,n=y.anchor,s=y.connections[0],r=this.makeAnchor(e,i,this),a=y.element;if(null!=r.positionFinder){var l=t(a,this),u=this.getSize(a),c={left:l.left+n.x*u[0],top:l.top+n.y*u[1]},f=r.positionFinder(c,l,u,r.constructorParams);r.x=f[0],r.y=f[1]}if(y.setAnchor(r,!0),o.parent){var p=d();if(p){var g=o.container||h;y.setElement(p,g)}}y.repaint(),this.repaint(y.elementId),this.repaint(s.targetId)}}.bind(this));var D=function(e){var t=this.getOriginalEvent(e),n=this.sourceEndpointDefinitions[f];if(i=this.getId(this.getDOMElement(r)),n.enabled){if(o.filter){var h=jsPlumbUtil.isString(o.filter)?Et(t,r,o.filter,this,o.filterExclude):o.filter(t,r);if(h===!1)return}var p=this.select({source:f}).length;if(n.maxConnections>=0&&n.uniqueEndpoint&&p>=n.maxConnections)return u&&u({element:r,maxConnections:a},e),!1;var g=jsPlumbAdapter.getPositionOnElement(t,c,l),m=g;o.parent&&(m=jsPlumbAdapter.getPositionOnElement(t,d(),l));var b={};P.extend(b,o),b.isTemporarySource=!0,b.anchor=[g[0],g[1],0,0],b.parentAnchor=[m[0],m[1],0,0],b.dragOptions=v,y=this.addEndpoint(i,b),E=!0,y.endpointWillMoveTo=o.parent?d():null,y._doNotDeleteOnDetach=!1,y._deleteOnDetach=!0;var D=function(){E&&(E=!1,s.deleteEndpoint(y))};s.registerListener(y.canvas,"mouseup",D),s.registerListener(r,"mouseup",D),s.trigger(y.canvas,"mousedown",e),jsPlumbUtil.consume(e)}}.bind(this);this.registerListener(r,"mousedown",D),this.sourceEndpointDefinitions[f].trigger=D,o.filter&&jsPlumbUtil.isString(o.filter)&&s.setDragFilter(r,o.filter)}.bind(this);n=L(n);for(var f=n.length&&n.constructor!=String?n:[n],p=0,g=f.length;g>p;p++)d(c(f[p]));return this},this.unmakeSource=function(e,t){var n=c(e),i=this.sourceEndpointDefinitions[n.id].trigger;return i&&s.unregisterListener(n.el,"mousedown",i),t||delete this.sourceEndpointDefinitions[n.id],this},this.unmakeEverySource=function(){for(var e in this.sourceEndpointDefinitions)s.unmakeSource(e,!0);return this.sourceEndpointDefinitions={},this},this.unmakeEveryTarget=function(){for(var e in this.targetEndpointDefinitions)s.unmakeTarget(e,!0);return this.targetEndpointDefinitions={},this};var Dt=function(t,n,i,s){var r="source"==t?this.sourceEndpointDefinitions:this.targetEndpointDefinitions;if(n=L(n),e.isString(n))r[n].enabled=s?!r[n].enabled:i;else if(n.length)for(var o=0,a=n.length;a>o;o++){var l=c(n[o]);r[l.id]&&(r[l.id].enabled=s?!r[l.id].enabled:i)}else{var u=c(n).id;r[u].enabled=s?!r[u].enabled:i}return this}.bind(this),jt=function(t,n){return t=L(t),e.isString(t)||!t.length?n.apply(this,[t]):t.length?n.apply(this,[t[0]]):void 0}.bind(this);this.toggleSourceEnabled=function(e){return Dt("source",e,null,!0),this.isSourceEnabled(e)},this.setSourceEnabled=function(e,t){return Dt("source",e,t)},this.isSource=function(e){return jt(e,function(e){return null!=this.sourceEndpointDefinitions[c(e).id]})},this.isSourceEnabled=function(e){return jt(e,function(e){var t=this.sourceEndpointDefinitions[c(e).id];return t&&t.enabled===!0})},this.toggleTargetEnabled=function(e){return Dt("target",e,null,!0),this.isTargetEnabled(e)},this.isTarget=function(e){return jt(e,function(e){return null!=this.targetEndpointDefinitions[c(e).id]})},this.isTargetEnabled=function(e){return jt(e,function(e){var t=this.targetEndpointDefinitions[c(e).id];return t&&t.enabled===!0})},this.setTargetEnabled=function(e,t){return Dt("target",e,t)},this.ready=function(e){s.bind("ready",e)},this.repaint=function(e,t,n){if("object"==typeof e&&e.length)for(var i=0,r=e.length;r>i;i++)k(e[i],t,n);else k(e,t,n);return s},this.repaintEverything=function(e){var t=n();for(var i in m)k(i,null,t,e);return this},this.removeAllEndpoints=function(e,t){var n=function(e){var i=c(e),r=m[i.id],o,a;if(r)for(o=0,a=r.length;a>o;o++)s.deleteEndpoint(r[o]);if(delete m[i.id],t&&i.el&&3!=i.el.nodeType&&8!=i.el.nodeType)for(o=0,a=i.el.childNodes.length;a>o;o++)n(i.el.childNodes[o])};return n(e),this},this.remove=function(e,t){var n=c(e);return s.doWhileSuspended(function(){s.removeAllEndpoints(n.id,!0),s.dragManager.elementRemoved(n.id),delete j[n.id],s.anchorManager.clearFor(n.id),s.anchorManager.removeFloatingConnection(n.id)},t===!1),n.el&&s.removeElement(n.el),s};var _t={},Ct=function(){for(var e in _t)for(var t=0,n=_t[e].length;n>t;t++){var i=_t[e][t];s.off(i.el,i.event,i.listener)}_t={}};this.registerListener=function(e,t,n){s.on(e,t,n),jsPlumbUtil.addToList(_t,t,{el:e,event:t,listener:n})},this.unregisterListener=function(e,t,n){s.off(e,t,n),jsPlumbUtil.removeWithFunction(_t,function(e){return e.type==t&&e.listener==n})},this.reset=function(){s.deleteEveryEndpoint(),s.unbind(),this.targetEndpointDefinitions={},this.sourceEndpointDefinitions={},v.splice(0),Ct(),s.anchorManager.reset(),jsPlumbAdapter.headless||s.dragManager.reset()},this.setDefaultScope=function(e){return w=e,s},this.setDraggable=q,this.setId=function(e,t,n){var i;jsPlumbUtil.isString(e)?i=e:(e=this.getDOMElement(e),i=this.getId(e));var s=this.getConnections({source:i,scope:"*"},!0),r=this.getConnections({target:i,scope:"*"},!0);t=""+t,n?e=this.getDOMElement(t):(e=this.getDOMElement(i),this.setAttribute(e,"id",t)),m[t]=m[i]||[];for(var o=0,a=m[t].length;a>o;o++)m[t][o].setElementId(t),m[t][o].setReferenceElement(e);delete m[i],this.anchorManager.changeId(i,t),this.dragManager&&this.dragManager.changeId(i,t);var l=function(n,i,s){for(var r=0,o=n.length;o>r;r++)n[r].endpoints[i].setElementId(t),n[r].endpoints[i].setReferenceElement(e),n[r][s+"Id"]=t,n[r][s]=e};l(s,0,"source"),l(r,1,"target"),this.repaint(t)},this.setDebugLog=function(e){f=e},this.setSuspendDrawing=function(e,t){var n=I;return I=e,O=e?(new Date).getTime():null,t&&this.repaintEverything(),n},this.isSuspendDrawing=function(){return I},this.getSuspendedAt=function(){return O},this.doWhileSuspended=function(t,n){var i=this.isSuspendDrawing();i||this.setSuspendDrawing(!0);try{t()}catch(s){e.log("Function run while suspended failed",s)}i||this.setSuspendDrawing(!1,!n)},this.getOffset=function(e){return E[e]},this.getCachedData=Q,this.timestamp=n,this.setRenderMode=function(e){if(e!==P.SVG&&e!==P.VML)throw new TypeError("Render mode ["+e+"] not supported");return A=jsPlumbAdapter.setRenderMode(e)},this.getRenderMode=function(){return A},this.show=function(e,t){return G(e,"block",t),s},this.toggleVisible=J,this.toggleDraggable=Z,this.addListener=this.bind,jsPlumbAdapter.headless||(s.dragManager=jsPlumbAdapter.getDragManager(s),s.recalculateOffsets=s.dragManager.updateOffsets)};jsPlumbUtil.extend(y,jsPlumbUtil.EventGenerator,{setAttribute:function(e,t,n){this.setAttribute(e,t,n)},getAttribute:function(e,t){return this.getAttribute(P.getDOMElement(e),t)},registerConnectionType:function(e,t){this._connectionTypes[e]=P.extend({},t)},registerConnectionTypes:function(e){for(var t in e)this._connectionTypes[t]=P.extend({},e[t])},registerEndpointType:function(e,t){this._endpointTypes[e]=P.extend({},t)},registerEndpointTypes:function(e){for(var t in e)this._endpointTypes[t]=P.extend({},e[t])},getType:function(e,t){return"connection"===t?this._connectionTypes[e]:this._endpointTypes[e]},setIdChanged:function(e,t){this.setId(e,t,!0)},setParent:function(e,t){var n=this.getElementObject(e),i=this.getDOMElement(n),s=this.getId(i),r=this.getElementObject(t),o=this.getDOMElement(r),a=this.getId(o);i.parentNode.removeChild(i),o.appendChild(i),this.dragManager.setParent(n,s,r,a)},getSize:function(e){return[e.offsetWidth,e.offsetHeight]},getWidth:function(e){return e.offsetWidth},getHeight:function(e){return e.offsetHeight},extend:function(e,t,n){var i;if(n)for(i=0;i<n.length;i++)e[n[i]]=t[n[i]];else for(i in t)e[i]=t[i];return e}},jsPlumbAdapter);var P=new y;"undefined"!=typeof window&&(window.jsPlumb=P),P.getInstance=function(e){var t=new y(e);return t.init(),t},"function"==typeof define&&(define("jsplumb",[],function(){return P}),define("jsplumbinstance",[],function(){return P.getInstance()})),"undefined"!=typeof exports&&(exports.jsPlumb=P)}();